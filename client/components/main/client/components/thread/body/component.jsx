import React, { useState } from "react"; 
import HeaderMessage from './header_message';
import Message from './message';
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import _ from 'lodash';

export default ({currentHive, currentThread, users, currentUser, action, fetchMessage, closeThread}) => {
    function isEmpty(obj) {
        for(var prop in obj) {
            if(obj.hasOwnProperty(prop)) {
                return false;
            }
        }
        return JSON.stringify(obj) === JSON.stringify({});
    }

    if (isEmpty(currentThread) || !currentThread) {
        return (
            <div className="c-virtual_list__item" tabIndex="-1" role="listitem" data-qa="virtual-list-item" style={{top: `${window.innerHeight*.2}px`, cursor: "default"}}>
                <div className="empty-thread-title" >
                    It's quiet in here...
                </div>
                <br />
                <br />
                <div className="empty-thread-placeholder">
                    <svg id="Layer_1" enableBackground="new 0 0 510.25 510.25" height="280" viewBox="0 0 510.25 510.25" width="280" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m510.25 255.126c0 24.144-3.354 47.504-9.621 69.64-14.117 49.864-60.26 82.661-98.907 115.073-44.324 37.172-85.461 48.945-147.834 48.945-140.902 0-240.458-89.91-240.458-230.812 0-41.67 9.229-80.817 26.944-115.556 13.656-26.776 19.231-53.855 41.028-74.132 45.548-42.369 106.609-68.283 173.723-68.283 140.902 0 255.125 114.223 255.125 255.125z" fill="#e4f6ff"/></g><path d="m490.714 333.52c-44.324 37.173-100.604 59.554-162.978 59.554-140.902 0-255.99-113.956-255.99-254.858 0-24.189 3.372-47.678 9.662-69.927-21.798 20.277-40.048 44.316-53.703 71.092-17.715 34.739-27.705 74.341-27.705 116.011 0 140.902 115.088 254.858 255.99 254.858 62.374 0 118.655-22.382 162.978-59.554 38.646-32.411 67.532-76.07 81.649-125.933-3.226 3.001-6.525 5.924-9.903 8.757z" fill="#cbe2ff"/><g><g><g><path d="m132.895 415.244h-10c-3.313 0-6-2.687-6-6s2.687-6 6-6h10c3.313 0 6 2.687 6 6s-2.686 6-6 6z" fill="#fff"/></g><g><path d="m284.524 446.767c-3.314 0-6-2.687-6-6v-20.003c0-3.313 2.686-6 6-6 3.313 0 6 2.687 6 6v20.003c0 3.313-2.687 6-6 6zm72.011-31.523h-18.602c-3.313 0-6-2.687-6-6s2.687-6 6-6h18.602c.431 0 .86-.004 1.288-.012 3.286-.027 6.049 2.572 6.112 5.886.063 3.313-2.573 6.05-5.886 6.112-.504.009-1.008.014-1.514.014zm-43.607 0h-20.003c-3.313 0-6-2.687-6-6s2.687-6 6-6h20.003c3.314 0 6 2.687 6 6s-2.686 6-6 6zm-45.008 0h-20.003c-3.313 0-6-2.687-6-6s2.687-6 6-6h20.003c3.314 0 6 2.687 6 6s-2.686 6-6 6zm-45.009 0h-20.003c-3.313 0-6-2.687-6-6s2.687-6 6-6h20.003c3.314 0 6 2.687 6 6s-2.686 6-6 6zm-45.008 0h-20.003c-3.313 0-6-2.687-6-6s2.687-6 6-6h20.004c3.313 0 6 2.687 6 6s-2.687 6-6.001 6zm204.454-4.766c-2.412 0-4.686-1.464-5.602-3.849-1.189-3.093.355-6.564 3.448-7.753 5.702-2.191 11.079-5.172 15.981-8.861 2.647-1.992 6.409-1.46 8.402 1.187 1.992 2.648 1.461 6.41-1.187 8.402-5.793 4.359-12.149 7.883-18.891 10.473-.709.272-1.436.401-2.151.401zm-97.833-8.719c-3.314 0-6-2.687-6-6v-20.004c0-3.313 2.686-6 6-6 3.313 0 6 2.687 6 6v20.004c0 3.313-2.687 6-6 6zm132.272-19.097c-1.129 0-2.27-.318-3.284-.982-2.771-1.817-3.545-5.536-1.729-8.308 3.362-5.128 5.986-10.686 7.798-16.518.983-3.164 4.344-4.934 7.51-3.949 3.164.983 4.932 4.346 3.949 7.51-2.144 6.899-5.247 13.472-9.221 19.536-1.151 1.757-3.068 2.711-5.023 2.711zm-132.272-25.912c-3.314 0-6-2.687-6-6v-17.757c0-.813.013-1.624.038-2.431.102-3.312 2.878-5.911 6.182-5.813 3.312.102 5.915 2.87 5.813 6.182-.021.685-.032 1.372-.032 2.062v17.757c-.001 3.314-2.688 6-6.001 6zm144.022-16.786c-3.313 0-6-2.686-6-6v-.97c0-5.851-.765-11.653-2.274-17.245-.863-3.199 1.031-6.493 4.23-7.356 3.197-.864 6.492 1.03 7.356 4.23 1.784 6.61 2.688 13.464 2.688 20.371v.97c0 3.314-2.687 6-6 6zm-138.952-27.57c-.738 0-1.488-.137-2.216-.426-3.079-1.225-4.582-4.714-3.357-7.793 2.669-6.711 6.266-13.024 10.69-18.764 2.023-2.625 5.792-3.112 8.415-1.09 2.625 2.023 3.113 5.791 1.09 8.415-3.744 4.857-6.787 10.198-9.044 15.874-.936 2.352-3.192 3.784-5.578 3.784zm125.921-14.733c-1.889 0-3.748-.889-4.916-2.553-3.519-5.011-7.714-9.511-12.468-13.374-2.572-2.09-2.962-5.869-.873-8.44 2.09-2.572 5.871-2.962 8.44-.873 5.614 4.562 10.566 9.875 14.721 15.792 1.904 2.712 1.25 6.454-1.462 8.358-1.048.737-2.251 1.09-3.442 1.09zm-97.702-19.387c-1.979 0-3.917-.979-5.062-2.77-1.785-2.792-.968-6.502 1.824-8.287 6.108-3.904 12.717-6.93 19.644-8.994 3.174-.946 6.517.861 7.463 4.037.946 3.175-.861 6.517-4.037 7.463-5.854 1.745-11.442 4.304-16.608 7.605-.999.64-2.118.946-3.224.946zm62.38-7.314c-.654 0-1.319-.107-1.971-.334-5.762-2.003-11.792-3.194-17.92-3.538-3.309-.186-5.84-3.019-5.654-6.327.186-3.309 3.02-5.835 6.327-5.654 7.243.407 14.372 1.815 21.189 4.186 3.13 1.088 4.785 4.508 3.696 7.638-.862 2.476-3.184 4.029-5.667 4.029z" fill="#fff"/></g><g><path d="m284.524 481.886c-3.313 0-6-2.687-6-6v-10c0-3.313 2.687-6 6-6s6 2.687 6 6v10c0 3.314-2.687 6-6 6z" fill="#fff"/></g></g><g><path d="m396.77 348.178c.116 0 .223.012.336.016 2.944-5.446 4.617-11.68 4.617-18.305 0-21.288-17.257-38.545-38.545-38.545h-207.444v56.833h241.036z" fill="#ffa50a"/></g><g><path d="m328.402 357.876h-126.87v61.2h158.047c4.63-6.36 7.368-14.186 7.368-22.655 0-21.287-17.257-38.545-38.545-38.545z" fill="#ffc305"/></g><g><path d="m242.15 416.979c-21.288 0-38.545-17.257-38.545-38.545 0-7.561 2.185-14.607 5.946-20.558h-24.229c-21.288 0-38.545 17.257-38.545 38.545 0 21.288 17.257 38.545 38.545 38.545h143.081c13.727 0 25.77-7.182 32.599-17.987z" fill="#ffa50a"/></g><g><path d="m196.792 346.636c-21.288 0-38.545-17.257-38.545-38.545 0-6.001 1.372-11.682 3.819-16.747h-11.521c-21.288 0-38.545 17.257-38.545 38.545 0 21.288 17.257 38.545 38.545 38.545h212.633c15.286 0 28.493-8.899 34.726-21.798z" fill="#f77e00"/></g><g><path d="m328.402 168.839h-143.08c-21.288 0-38.545-17.257-38.545-38.545 0-21.288 17.257-38.545 38.545-38.545h143.081c21.288 0 38.545 17.257 38.545 38.545-.001 21.288-17.258 38.545-38.546 38.545z" fill="#ffc305"/></g><g><path d="m328.402 91.749h-129.171c-1.737 4.388-2.701 9.166-2.701 14.172 0 21.288 17.257 38.545 38.545 38.545h129.172c1.737-4.388 2.701-9.166 2.701-14.172-.001-21.288-17.258-38.545-38.546-38.545z" fill="#ffa50a"/></g><g><path d="m363.178 158.281h-212.632c-4.513 0-8.842.783-12.866 2.208v72.674c4.025 1.425 8.353 2.208 12.866 2.208h212.633c21.288 0 38.545-17.257 38.545-38.545-.001-21.288-17.258-38.545-38.546-38.545z" fill="#ffa50a"/></g><g><path d="m390.026 210.93h-212.632c-21.288 0-38.545-17.257-38.545-38.545 0-4.536.79-8.887 2.229-12.929-16.71 4.22-29.078 19.349-29.078 37.37 0 21.288 17.257 38.545 38.545 38.545h212.633c16.751 0 31.001-10.689 36.316-25.616-3.03.765-6.2 1.175-9.468 1.175z" fill="#f77e00"/></g><g><path d="m422.645 283.884c3.749-5.945 5.926-12.979 5.926-20.527 0-21.288-17.257-38.545-38.545-38.545h-265.998v59.072z" fill="#ffc305"/></g><g><path d="m163.284 281.654c-21.288 0-38.545-17.257-38.545-38.545 0-6.622 1.672-12.853 4.613-18.297h-5.654c-21.288 0-38.545 17.257-38.545 38.545 0 21.288 17.257 38.545 38.545 38.545h266.329c14.666 0 27.417-8.192 33.932-20.248z" fill="#ffa50a"/></g><g><g><path d="m256.862 367.89c-48.265 0-87.532-39.267-87.532-87.532 0-48.266 39.267-87.532 87.532-87.532s87.532 39.267 87.532 87.532-39.267 87.532-87.532 87.532zm0-153.064c-36.134 0-65.532 29.397-65.532 65.532 0 36.134 29.397 65.532 65.532 65.532s65.532-29.397 65.532-65.532-29.398-65.532-65.532-65.532z" fill="#f77e00"/></g></g><g><circle cx="256.862" cy="263.358" fill="#bc3f2a" r="76.532"/></g><g><path d="m249.458 293.969c-13.773-6.268-25.07-17.063-31.867-30.583-11.02-21.919-11.662-43.53-5.534-62.058-28.108 20.339-41.875 59.276-23.11 98.794 6.595 13.889 17.954 25.029 31.898 31.505 47.229 21.932 93.5-2.438 107.935-42.103.241-.663-.52-1.23-1.103-.833-20.967 14.258-49.356 18.413-78.219 5.278z" fill="#912f2f"/></g><g><path d="m256.862 175.826c-1.128 0-2.249.031-3.366.074v22.021c1.116-.057 2.237-.095 3.366-.095 36.134 0 65.532 29.397 65.532 65.532 0 36.134-29.397 65.532-65.532 65.532s-65.532-29.397-65.532-65.532c0-1.048.03-2.088.079-3.124h-22.018c-.037 1.037-.062 2.078-.062 3.124 0 48.265 39.267 87.532 87.532 87.532s87.532-39.267 87.532-87.532c.001-48.266-39.266-87.532-87.531-87.532z" fill="#ffa50a"/></g><g><path d="m180.33 274.358c-6.075 0-11-4.925-11-11 0-48.266 39.267-87.532 87.532-87.532 6.075 0 11 4.925 11 11s-4.925 11-11 11c-36.134 0-65.532 29.397-65.532 65.532 0 6.075-4.925 11-11 11z" fill="#ffc305"/></g><g><path d="m296.807 91.749h-78.211c0-16.306 13.218-29.524 29.524-29.524h19.162c16.306 0 29.525 13.218 29.525 29.524z" fill="#bc3f2a"/></g><path d="m268.701.361c-4.496-.236-9.021-.36-13.576-.36-2.82 0-5.626.062-8.424.153v76.833h22z" fill="#bc3f2a"/><g><path d="m164.158 270.703c-2.953 0-5.526-2.18-5.938-5.188-.449-3.283 1.849-6.309 5.132-6.758 5.973-.816 11.721-2.617 17.083-5.351 2.953-1.504 6.565-.331 8.071 2.621 1.505 2.952.332 6.565-2.621 8.071-6.564 3.346-13.598 5.549-20.907 6.549-.276.038-.55.056-.82.056zm-24.741-1.762c-.549 0-1.106-.076-1.66-.235-7.069-2.032-13.712-5.221-19.745-9.479-2.707-1.911-3.352-5.655-1.441-8.362 1.911-2.706 5.653-3.353 8.362-1.441 4.933 3.482 10.362 6.089 16.138 7.75 3.185.915 5.024 4.239 4.109 7.424-.756 2.63-3.155 4.343-5.763 4.343zm63.041-19.786c-1.332 0-2.672-.441-3.785-1.348-2.57-2.092-2.957-5.872-.864-8.441 3.812-4.681 6.787-9.917 8.844-15.564 1.134-3.113 4.579-4.718 7.691-3.584 3.114 1.134 4.718 4.577 3.584 7.691-2.516 6.909-6.154 13.313-10.814 19.035-1.186 1.456-2.914 2.211-4.656 2.211zm-97.869-7.009c-2.038 0-4.024-1.038-5.149-2.912-3.8-6.326-6.486-13.19-7.986-20.403-.674-3.245 1.409-6.421 4.653-7.096 3.239-.672 6.421 1.409 7.096 4.653 1.225 5.891 3.419 11.498 6.524 16.667 1.706 2.84.787 6.526-2.054 8.233-.968.581-2.033.858-3.084.858zm111.421-34.862c-.048 0-.096 0-.144-.001-3.313-.078-5.935-2.827-5.857-6.14l.471-19.994c.078-3.313 2.806-5.914 6.14-5.857 3.313.078 5.935 2.827 5.857 6.14l-.471 19.995c-.078 3.262-2.749 5.857-5.996 5.857zm-118.876-8.519c-.333 0-.669-.028-1.008-.085-3.268-.553-5.468-3.649-4.916-6.917 1.203-7.111 3.358-14.031 6.406-20.567 1.4-3.003 4.97-4.303 7.974-2.901 3.003 1.4 4.302 4.97 2.901 7.974-2.593 5.561-4.427 11.447-5.45 17.496-.494 2.928-3.034 5-5.907 5zm119.936-36.469c-.048 0-.096 0-.144-.001-3.313-.078-5.935-2.827-5.857-6.14l.467-19.843-10.588.039c-3.348-.02-6.01-2.665-6.022-5.978-.012-3.314 2.665-6.01 5.978-6.022l20-.073h.022c3.304 0 5.987 2.672 6 5.978.009 2.397-1.39 4.471-3.418 5.439.025.245.035.495.029.747l-.471 19.995c-.078 3.265-2.748 5.859-5.996 5.859zm-99.904-3.048c-1.503 0-3.009-.562-4.174-1.69-2.38-2.305-2.441-6.104-.135-8.484 5.02-5.182 10.704-9.672 16.896-13.344 2.85-1.691 6.531-.75 8.221 2.1s.75 6.531-2.1 8.221c-5.275 3.128-10.119 6.955-14.397 11.371-1.178 1.216-2.744 1.826-4.311 1.826zm38.858-21.298c-2.796 0-5.298-1.964-5.875-4.811-.657-3.248 1.443-6.414 4.691-7.071 5.176-1.047 10.5-1.588 15.826-1.607l5.237-.019h.022c3.304 0 5.987 2.672 6 5.978.012 3.314-2.665 6.01-5.978 6.022l-5.238.019c-4.542.016-9.081.477-13.489 1.369-.401.081-.801.12-1.196.12zm89.9-1.764c-3.304 0-5.987-2.672-6-5.978-.012-3.314 2.665-6.01 5.978-6.022l20-.073h.022c3.304 0 5.987 2.672 6 5.978.012 3.314-2.665 6.01-5.978 6.022l-20 .073c-.006 0-.014 0-.022 0zm45-.163c-3.304 0-5.987-2.672-6-5.978-.012-3.314 2.665-6.01 5.978-6.022l20-.073h.022c3.304 0 5.987 2.672 6 5.978.012 3.314-2.665 6.01-5.978 6.022l-20 .073c-.006 0-.014 0-.022 0zm45-.164c-3.304 0-5.987-2.672-6-5.978-.012-3.314 2.665-6.01 5.978-6.022l20-.073c3.275-.038 6.01 2.665 6.022 5.978.012 3.314-2.665 6.01-5.978 6.022l-20 .073c-.007 0-.015 0-.022 0zm-117.794-18.55c-.048 0-.096 0-.144-.001-3.313-.078-5.935-2.827-5.857-6.14l.452-19.854c0-3.313 2.687-6 6-6s6 2.687 6 6l-.001.903-.453 19.232c-.079 3.265-2.75 5.86-5.997 5.86zm.45-44.995c-3.313 0-6-2.687-6-6v-20c0-3.313 2.687-6 6-6s6 2.687 6 6v20c0 3.313-2.687 6-6 6z" fill="#fff"/></g><g><g><g><path d="m83.741 434.05s-12.612 47.298-22.19 56.876-25.108 9.578-34.686 0-9.578-25.108 0-34.686 56.876-22.19 56.876-22.19z" fill="#e2f4f9"/></g><g><path d="m86.062 435.076s12.612 47.298 22.19 56.876 25.108 9.578 34.686 0 9.578-25.108 0-34.686c-9.579-9.579-56.876-22.19-56.876-22.19z" fill="#e2f4f9"/></g><g fill="#bc3f2a"><path d="m103.952 439.774c-4.623-9.333-11.955-15.366-20.212-15.366s-15.588 6.033-20.212 15.366z"/><path d="m59.45 473.242h48.724c.579-3.244.894-6.654.894-10.178 0-2.654-.176-5.244-.51-7.748h-49.634c-.334 2.503-.51 5.094-.51 7.748 0 3.526.315 6.939.895 10.185.048-.001.092-.007.141-.007z"/><path d="m64.84 488.784c4.638 7.935 11.385 12.935 18.901 12.935 7.515 0 14.262-5.001 18.901-12.935z"/></g></g><g><g><path d="m58.863 455.839h49.756c-.734-5.921-2.347-11.366-4.633-16h-40.49c-2.286 4.634-3.899 10.079-4.633 16z" fill="#ffc305"/></g><g><path d="m102.61 488.839c2.645-4.508 4.608-9.965 5.638-16h-49.015c1.03 6.035 2.993 11.492 5.638 16z" fill="#ffc305"/></g></g></g><g><g><g><path d="m438.314 72.923s-42.362 24.527-55.908 24.527-24.527-10.981-24.527-24.527 10.981-24.527 24.527-24.527 55.908 24.527 55.908 24.527z" fill="#e2f4f9"/></g><g><path d="m439.23 75.289s-24.527 42.362-24.527 55.908 10.981 24.527 24.527 24.527 24.527-10.981 24.527-24.527-24.527-55.908-24.527-55.908z" fill="#e2f4f9"/></g><g><path d="m435.707 111.347c-2.388 2.388-4.905 4.504-7.49 6.335-2.586 1.832-7.457.556-10.117 1.804-2.478 1.163-2.745 4.89-5.184 5.525-8.868 2.31-17.149 1.063-22.452-4.239-5.302-5.302-6.549-13.584-4.239-22.452.69-2.651 3.768-3.638 5.081-6.33 1.192-2.444.565-6.594 2.249-8.971 1.831-2.585 3.947-5.102 6.335-7.49 1.746-1.746 3.561-3.347 5.422-4.797 2.289-1.785 7.011-1.203 9.391-2.522 2.513-1.393 2.689-4.659 5.202-5.512.278-.094.556-.185.833-.273 9.591-3.03 18.706-2.008 24.394 3.679 5.852 5.852 6.764 15.333 3.406 25.227-.869 2.561-3.825 2.97-5.254 5.53-1.302 2.332-1.031 6.82-2.78 9.063-1.451 1.862-3.051 3.677-4.797 5.423z" fill="#bc3f2a"/></g></g><g><g><path d="m405.316 70.739 35.183 35.183c3.668-4.706 6.377-9.697 8.038-14.59l-28.631-28.631c-4.893 1.66-9.885 4.37-14.59 8.038z" fill="#ffc305"/></g><g><path d="m412.915 125.007c5.057-1.317 10.305-3.788 15.3-7.327l-34.659-34.659c-3.539 4.996-6.01 10.243-7.327 15.3z" fill="#ffc305"/></g></g></g></g></g></svg>
                </div>
            </div>
        );
    } else {
        let initialMessage = _.cloneDeep(currentThread);
        initialMessage.children = [];

        return (
            <>
                <HeaderMessage key={initialMessage.id} 
                    currentHive={currentHive}
                    currentThread={initialMessage} 
                    message={initialMessage} 
                    users={users} 
                    currentUser={currentUser}
                    action={action}
                />
                <div>
                    {
                        currentThread.children.map((message) => {
                            return (
                                <Message key={message.id} 
                                    currentHive={currentHive}
                                    currentThread={initialMessage}
                                    message={message} 
                                    users={users}
                                    currentUser={currentUser}
                                    action={action}
                                />
                            )
                        })
                    }
                </div>
            </>
        );
    }
}
